<!DOCTYPE html>
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-113333628-1"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

        gtag('config', 'UA-113333628-1');
  </script>
  <title>同方有云 - 新闻</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no, maximum-scale=1, width=device-width">
  <meta name="keywords" content="云计算,同方云,云平台,私有云,公有云,Openstack,云存储,云硬盘,云主机" />
  <meta name="description" content="同方云产品与解决方案覆盖IT建设全栈，从基础环境建设（风、火、水、电）、硬件设备、再到云平台操作系统、存储、大数据、云安全产品与方案，甚至到各个行业的行业云和应用，为其提供端到端的公有云、私有云、混合云IT建设一站式服务。" />
  <meta name="robots" content="all" />
  <link rel="stylesheet" type="text/css" href="/static/common/style/7e2b52.index.css" />
  <link rel="stylesheet" type="text/css" href="/static/dist/7faf53.page_support_tf-news_detail-three.min.css" />
  <link href="/static/assets/favicon.ico" mce_href="/static/assets/favicon.ico" rel="icon" type="image/x-icon" /> 
</head>
<body >
<div id="volcano-global-header" class="volcano-global-header">
  <div class="header-wrapper">
    <div class="header-left">
      <a href="/"></a>
      <div id="x-open" class="x-wrapper">
        <div class="x-1"></div>
        <div class="x-2"></div>
      </div>
    </div>
    <ul id="header-center" class="header-center">
      <li>
        <a href="javascript:void(0)" class="public-cloud bottom">
          公有云
          <i class="icon-arrow-down"></i>
        </a>
        <div class="dropdown-wrapper">
          <ul class="dropdown">
            <li><a href="/public/compute">计算</a></li>
            <li><a href="/public/network">网络</a></li>
            <li><a href="/public/storage">存储</a></li>
            <li><a href="/public/alarm">监控报警</a></li>
            <li><a href="/public/price">价格预算</a></li>
          </ul>
        </div>
      </li>

      <li class="multi-dropdown">
        <a href="javascript:void(0)" class="uos-product bottom">
          产品
          <i class="icon-arrow-down"></i>
        </a>
        <div class="dropdown-wrapper wide-wrapper">
          <ul class="dropdown wide">
            <li><a href="/product/environment">基础环境建设</a></li>
            <li class="multi">
              <a class="four" href="javascript:void(0)">硬件设备
                <i class="icon-arrow-right"></i>
                <i class="icon-arrow-down"></i>
              </a>
              <ul class="child-dropdown">
                <li class="two"><a href="/product/hardware/rack-server">机架式服务器</a></li>
                <li class="two"><a href="/product/hardware/tower-server">塔式服务器</a></li>
                <li class="two"><a href="/product/hardware/blade-server">刀片式服务器</a></li>
                <li class="two"><a href="/product/hardware/enterprise-storage">企业级存储</a></li>
              </ul>
            </li>
            <li class="multi">
              <a class="five" href="javascript:void(0)">全栈云平台
                <i class="icon-arrow-right"></i>
                <i class="icon-arrow-down"></i>
              </a>
              <ul class="child-dropdown">
                <li class="two"><a href="/product/cloud-platform/product">全栈云平台</a></li>
                <li class="two"><a href="/product/cloud-platform/enterprise">Enterprise</a></li>
                <li class="two"><a href="/product/cloud-platform/director">Director</a></li>
                <li class="two"><a href="/product/cloud-platform/operator">Operator</a></li>
                <li class="two"><a href="/product/cloud-platform/manager">Manager</a>
              </ul>
            </li>
            <li><a href="/product/storage">存储</a></li>
            <li><a href="/product/big-data">大数据</a></li>
            <li><a href="/product/cloud-security">云安全</a></li>
            <li><a href="/product/om-management">运维管理服务</a></li>
          </ul>
        </div>
      </li>
      <li>
        <a href="javascript:void(0)" class="bottom">
          服务与支持
          <i class="icon-arrow-down"></i>
        </a>
        <div class="dropdown-wrapper">
          <ul class="dropdown">
            <li><a href="/support/product-service">产品服务</a></li>
            <li><a href="/support/technical-support">技术支持</a></li>
            <li><a href="/support/online-flow">上线流程</a></li>
            <li><a href="/support/apply-now">立即申请</a></li>
            <li><a href="/support/tf-news/list">有云新闻</a></li>
            <li><a href="/support/quality-assurance">质量保障</a></li>
          </ul>
        </div>
      </li>
      <li>
        <a href="javascript:void(0)" class="bottom">
          技术培训
          <i class="icon-arrow-down"></i>
        </a>
        <div class="dropdown-wrapper">
          <ul class="dropdown">
            <li><a href="/train/technical-train">技术培训</a></li>
            <li><a href="/train/train-list">培训列表</a></li>
            <li><a href="/train/train-apply">培训申请</a></li>
          </ul>
        </div>
      </li>
      <li>
        <a href="javascript:void(0)" class="bottom">
          关于我们
          <i class="icon-arrow-down"></i>
        </a>
        <div class="dropdown-wrapper">
          <ul class="dropdown">
            <li><a href="/about/company">关于我们</a></li>
            <li><a href="/about/contact-us">联系我们</a></li>
            <li><a href="/about/identify">企业标识</a></li>
            <li><a href="/about/clients">客户案例</a></li>
            <li><a href="/about/jobs">人才招聘</a></li>
          </ul>
        </div>
      </li>
      <li>
        <a href="javascript:void(0)" class="bottom">
          合作伙伴
          <i class="icon-arrow-down"></i>
        </a>
        <div class="dropdown-wrapper">
          <ul class="dropdown">
            <li><a href="/cooperation/cooperation-apply">合作申请</a></li>
          </ul>
        </div>
      </li>
      <li class="mobile-login">
        <div class="login-wrapper">
          <a class="login-link" href="javascript:void(0)">
            控制台
            <i class="icon-arrow-right"></i>
          </a>
          <a class="register-link" href="javascript:void(0)">
            注册
            <i class="icon-arrow-right"></i>
          </a>
        </div>
      </li>
<!--       <li class="mobile-lang">
        <a href="?lang=zh">中文</a>
        &nbsp;&nbsp;|&nbsp;&nbsp;
        <a href="?lang=en">English</a>
      </li> -->
    </ul>
    <div class="header-right">
      
        <div class="login-wrapper">
          <a class="login-link" href="javascript:void(0)">控制台</a>
          <a class="signup register-link" href="javascript:void(0)">注册</a>
        </div>
      
<!--       <div class="lang" style="display: inline-block"><a href="?lang=en">EN</a></div>
      <div class="lang" style="display: none"><a href="?lang=zh">中</a></div> -->
    </div>
  </div>
</div>

  <div class="volcano-news">
    <article >
      <!-- banner -->
      <section class="content-banner">
        <div class="type-area">
          <div class="banner">
            <div class="banner-title">最新的</div>
            <div class="banner-brief">同方有云新闻时事热点</div>
            <div class="banner-describe">同方有云新闻是包含海量云计算资讯的新闻服务平台,真实反映每时每刻的新闻热点。您可以搜索新闻事件、热点话题、人物动态、产品资讯等,快速了解它们的中国云市场的最新进展。</div>
            <div class="banner-describe-mobile">同方有云新闻是包含海量云计算资讯的新闻服务平台</div>
          </div>
        </div>
        <div class="banner-img" style="background:url(/static/assets/page-views/support/tf-news/list/banner.png) no-repeat center center;background-size:cover"></div>
      </section>
      <div class="breadcrumb">
        <ul class="breadcrumb-center">
          <li class="first"><a class="firstpage" href="/">首页</a>&nbsp;/&nbsp;</li>
          <li class="second"><a class="success" href="/product/environment">服务与支持</a>&nbsp;/&nbsp;</li>
          <li class="third">同方有云新闻</li>
        </ul>
      </div>
      <section class="content-main">
        <div class="inner">
          <div class="left-content">
            <div class="news">
              <div class="item">
                <div class="title">悉尼峰会行 | 主题分享：大规模生产环境下Telemetry的使用</div>
                <p class="brief">
                  <span class="author">姚宁</span>
                  &nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;
                  <span class="date">2017-11-11</span>
                </p>
                <div class="detail wangEditor-container" style="border: none">
                  <p>2017年11月06日-08日，第16届OpenStack峰会在悉尼成功举行。UnitedStack同方有云，中国最早的 OpenStack 开源云计算公司，作为黄金会员赞助并出席了本次峰会。同方有云的工程师团队为峰会带来了来自中国公司的主题分享，其中高级工程师姚宁的分享主题为《大规模生产环境下Telemetry的使用》。</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-0.jpeg"></div>
                  <p class="share-content">分享内容</p>
                  <p>Telemetry 是 OpenStack 的监控计量项目，原项目称为 ceilometer，它需要完成数据采集、数据存储、数据查询、监控告警策略等一系列的逻辑，因此该项目也越来越庞大，导致其越来越难维护，故从 Liberty 版开始，社区将其逻辑进行拆分，并衍生出了 4个项目， 分别为 ceilometer，gnocchi，panko，aodh，而这4个项目统称为 Telemetry。 </p>
                  <p>由于 Telemetry 在 OpenStack 生态圈中，使用的人较少，而本次的重构拆分和迭代的版本</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-1.png"></div>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-2.png"></div>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-3.png"></div>
                  <p>首先，我们来看一张图显示的测试结果：</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-4.jpeg"></div>
                  <p>从上图可知，我们在 3控制节点，6计算节点的环境下，创建出了 2000 台虚拟机。然而控制节点上面 cpu 的利用率达到了 70% 以上（gnocchi-api 使用率最高），内存的利用率达到了 80% 以上 （ceilometer 使用率最高），且计算节点上，Ceph 后端磁盘上的压力达到了 SSD 磁盘带宽的 90% 以上。那么到底是什么造成了这样的结果，分析如下：</p>
                  <p>首先，针对Ceph 存储带宽被耗尽的问题，Gnocchi 后端存储 3种类型的数据，Measure Storage 存储从 API 发来的临时的 Measure 数据；Metricd 通过对 Measure Storage 中数据进行聚合，形成可查询的时序数据，存储入 Aggregate Storage；Index Storage 用于存储元数据，从而组织起有哪些 metrics 监控项，这些 metrics 属于那个 resource 等等。</p>
                  <p>但是，在 P版本之前，Measure Storage 和 Aggregate Storage 只能使用同一种后端，如果配置了 Ceph 那么就必须使用 Ceph，可是 Ceph 在 Measure Storage 存储数据的时候，有一个很严重的问题是 Ceph 将 Key-Value 的数据都存储在了 Rocksdb/LevelDB 中，而 Rocksdb 和 Leveldb 具有极大的读写放大，根据测试结果，Rocksdb 中写入 45G 用户数据，可能被放大成 1868GB，放大系数高达 42倍，如下图：</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-5.jpeg"></div>
                  <p>而对于高频率，高读写的临时 Measure 数据，是非常不适合存储在 Rocksdb 中，这是导致底层磁盘带宽过度消耗的主要原因。所以我们能做的就是将 Measure Storage 和 Aggregate Storage 的后端分离，Measure Storage 后端使用 redis，而 Aggregate Storage 的后端使用 Ceph，在 P版中配置如下：</p>
                  <div class="code">
                  <p>[incoming]</p>
                  <p>redis_url = ${storage.redis_url}</p>
                  <p>[storage]</p>
                  <p>driver = ceph</p>
                  <p>ceph_pool = gnocchi</p>
                  <p>ceph_username = None </p>
                  <p>ceph_secret = None </p>
                  <p>ceph_keyring = None </p>
                  <p>ceph_conffile = /etc/ceph/ceph.conf</p></div>
                  <p>其次，如果我们使用 Ceilometer 进行数据收集，假设我们有 3 个 ceilometer notification agent，那么，如下图所示</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-6.png"></div>
                  <p>其中，A，B，C，D 代表每个 metric 监控项，A1 代表第一次监控数据，A2 代表第二次监控数据。然而，可能出现的情况如下：</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-7.jpeg"></div>
                  <p>A 监控项的数据分布到了两个不同的 ceilometer agent 上面，那么如果我们需要计算磁盘 IO 速率这种指标，disk read per second: ∆𝒙 / period，这里 ∆𝒙=A3 - A1。∆𝒙 与我们原先希望的 A2 - A1 不同，而且由于我们需要计算差值，就必须存储所有监控项的上一次差值，那么在这种情况下，第一个 ceilometer agent 会存储 A 监控项上一次的值 A1，而第三个 ceilometer agent 上面也会存储 A 监控项上一次的值 A2，这就导致了到虚拟机和监控项数据增加的时候，ceilometer notification agent 的内存使用率将直线增加，从而严重影响水平可扩展性和资源效率。</p>
                  <p>所以我们需要正确配置 workload_partitioning，使得不同监控项到达 ceilometer notification agent 以后能够被重新分发进以监控资源为关键字索引的队列，然后让特定的 ceilometer notification agent 去处理，这样就保证了一个监控项中的值最后只会被特定的 ceilometer notification agent 处理，如下图所示：</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-8.jpeg"></div>
                  <p>最后，就是 ceilometer 向 gnocchi 传输数据的时候，使用 http 协议的问题，这导致了平凡更新的监控数据高频率的调用 API，而 API 调用操作是一次非常重量级的操作，需要和 keystone，数据库等多个后端组件交互，严重影响的单控制节点对请求的处理效率，消耗大量的 cpu 计算时间。我们在这里提出，监控数据应该使用 UDP 协议来进行传输上报，如何调优及使用，我们将在下次继续介绍，有兴趣的小伙伴们请持续关注我们。</p>
                  <p>在优化后，我们平台能够承载的虚拟机数量和监控项数量大幅度增加，如下图所示：</p>
                  <div><img src="/static/assets/page-views/support/tf-news/detail-three/news3-9.png"></div>
                  <p>原先平台只能支撑 500 台虚拟机（每台虚机 20个监控项），以每 5分钟一个采样点进行采样监控。经过优化，在同样的情况下，我们可以轻松的支撑 2000 台虚拟机 1分钟一个采样点进行采样。</p>
                  <p class="sum">总结，目前 Telemetry 项目在真正的使用中，成熟度仍然欠佳，但是我们也看到了 Telemetry 项目的持续发展 和 走出困境的决心，并且在你能够深入的掌控和很好的配置且使用 Telemetry 的情况下，它已经能够承载小规模或一定规模集群的监控告警和计量任务，有兴趣的小伙伴们快来试一试吧。</p>
                </div>
              </div>
              <div class="share">
                <i class="icon-wechat"></i>
                <i class="icon-weibo"></i>
                <i class="icon-facebook"></i>
              </div>
              <div class="page-link">
                  <div class="prev"><p>上一篇</p> <a href="/support/tf-news/detail-two">同方有云助力同方发力信息产业2.0</a></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </article>
  </div>
<div class="volcano-global-footer">
  <div class="caller">
    <div class="center">
      <span class="reply">我们将及时回复您</span>
      <span class="time">24×7×365</span>
      <a href="/"><img class="weixin" src="/static/assets/weixin.png"></a>
      <a href="/"><img class="weibo" src="/static/assets/weibo.png"></a>
    </div>
  </div>
  <div id="volcano-totop" class="totop">
    <i class="icon-arrow-up"></i>
  </div>
  <div class="first">
    <div class="inner">
      <div class="left">
        <h6 class="title">联系我们</h6>
        <div class="phone">
          <i class="icon-phone"></i>方案咨询： 400-898-5401
        </div>
        <div class="service-center">
          <i class="icon-service-center"></i>技术支持： 010-86461598
        </div>
        <div class="email">
          <i class="icon-email"></i>contact@unitedstack.com
        </div>
        <div class="copyright">Copyright © 2018</div>
        <div class="compony">同方有云（北京）科技有限公司</div>
        <div class="openstack">
          <img src="/static/assets/openstack-gold-member-badge.png" />
          <img src="/static/assets/openstack-logo-powered.png" />
          <img src="/static/assets/openstack-logo-training.png" />
        </div>
      </div>
      <div class="center">
        <div class="column-1">
          <div class="item-1">
            <div class="title">公有云</div>
            <p><a href="/public/compute">计算</a></p>
            <p><a href="/public/network">网络</a></p>
            <p><a href="/public/storage">存储</a></p>
            <p><a href="/public/alarm">监控报警</a></p>
            <p><a href="/public/price">价格预算</a></p>
          </div>
        </div>
        <div class="column-2">
          <div class="item-1">
            <div class="title">产品</div>
            <p><a href="/product/environment">基础环境建设</a></p>
            <p><a href="/product/hardware/rack-server">硬件设备</a></p>
            <p><a href="/product/cloud-platform/product">全栈云平台</a></p>
            <p><a href="/product/storage">存储</a></p>
            <p><a href="/product/big-data">大数据</a></p>
            <p><a href="/product/cloud-security">云安全</a></p>
            <p><a href="/product/om-management">运维管理服务</a></p>
          </div>
        </div>
        <div class="column-3">
          <div class="item-1">
            <div class="title">服务与支持</div>
            <p><a href="/support/product-service">产品服务</a></p>
            <p><a href="/support/technical-support">技术支持</a></p>
            <p><a href="/support/online-flow">上线流程</a></p>
            <p><a href="/support/apply-now">立即申请</a></p>
            <!-- <p><a href="/support/blog">技术社区</a></p> -->
            <p><a href="/support/tf-news/list">有云新闻</a></p>
            <p><a href="/support/quality-assurance">质量保障</a></p>
          </div>
        </div>
        <div class="column-4">
          <div class="item-1">
            <div class="title">技术培训</div>
            <p><a href="/train/technical-train">技术培训</a></p>
            <p><a href="/train/train-list">培训列表</a></p>
            <p><a href="/train/train-apply">培训申请</a></p>
          </div>
        </div>
        <div class="column-5">
          <div class="item-1">
            <div class="title">关于我们</div>
            <p><a href="/about/company">关于我们</a></p>
            <p><a href="/about/contact-us">联系我们</a></p>
            <p><a href="/about/identify">企业标识</a></p>
            <p><a href="/about/clients">客户案例</a></p>
          </div>
        </div>
        <div class="column-6">
          <div class="item-1">
            <div class="title">合作伙伴</div>
            <p><a href="/cooperation/cooperation-apply">合作申请</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="second">
<!--     <div class="wrapper">
      <div class="row-1">
        ©2017 UnitedStack Inc. All Rights Reserved. <a href="http://www.miitbeian.gov.cn/state/outPortal/loginPortal.action">京ICP备13015821号</a>
      </div>
      <div class="row-2">
        <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020347">京公网安备 11010802020347号</a>
      </div>
    </div> -->
  </div>
  <div class="mobile-footer">
    <div class="content-wrapper">
      <div class="header">
        <a href="javascript:void(0)">公有云</a> &nbsp;|&nbsp;
        <a href="javascript:void(0)">产品</a> &nbsp;|&nbsp;
        <a href="javascript:void(0)">服务与支持</a>&nbsp;|&nbsp;
        <a href="javascript:void(0)">技术培训</a>&nbsp;|&nbsp;
        <a href="javascript:void(0)">关于我们</a>&nbsp;|&nbsp;
        <a href="javascript:void(0)">合作伙伴</a>&nbsp;
      </div>
      <div class="contact">
        <div class="title">联系我们</div>
        <a href="tel:400-898-5401" class="call">
          <i class="icon-phone"></i>
          400-898-5401
        </a>
      </div>
      <div class="footer">
        <img src="/static/assets/openstack-gold-member-badge.png" />
        <img src="/static/assets/openstack-logo-powered.png" />
        <img src="/static/assets/openstack-logo-training.png" />
      </div>
    </div>
  </div>
</div>
</body>
<script src="/static/third-party/jquery-3.2.1.min.js"></script>
<script src="/static/common/js/ec768b.g.js"></script>
<script src="/static/dist/7faf53.page_support_tf-news_detail-three.min.js"></script>
<!-- Hotjar Tracking Code for https://www.tfcloud.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:843659,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</html>